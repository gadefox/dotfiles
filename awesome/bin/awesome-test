#!/bin/rc

disp = :9

. /usr/local/libexec/rc/notify
notify_icon = awesome
notify_title = 'Awesome:'

id = `{ wmctrl -l | grep $disp.0 }

if (~ $1 1) {
  ~ $id () || notify_error 'Test session is already running.'

  Xephyr -ac -br -noreset -screen 1100x620 $disp &
  while (!xset -display $disp q > /dev/null >[2=1]) {}
  DISPLAY=$disp awesome &

  notify_show 'New session is ready for tests.'
  exit 0
}

if (~ $1 2) {
  ~ $id () && notify_error 'Test session is not running.'
  wmctrl -i -c $id(1)

  notify_show 'Test session has been closed.'
  exit 0
}

if (~ $1 3) {
  ~ $id () && notify_error 'Test session is not running.'
  id = `(pidof awesome)
  kill -s SIGHUP $id(1)

  notify_show 'Test session has been restarted.'
  exit 0
}

exit 1
